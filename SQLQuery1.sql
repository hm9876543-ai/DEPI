
CREATE TABLE DEPARTMENT (
    DeptID INT PRIMARY KEY,
    DeptName NVARCHAR(50) NOT NULL UNIQUE,
    ManagerID INT UNIQUE
);

-- EMPLOYEE
CREATE TABLE EMPLOYEE (
    EmpID INT PRIMARY KEY,
    Name NVARCHAR(50) NOT NULL,
    Gender CHAR(1) NOT NULL CHECK (Gender IN ('M','F')),
    DeptID INT NOT NULL,
    Salary DECIMAL(10,2) DEFAULT 3000
);

ALTER TABLE DEPARTMENT
ADD CONSTRAINT FK_Dep_Manager FOREIGN KEY (ManagerID)
    REFERENCES EMPLOYEE(EmpID);

ALTER TABLE EMPLOYEE
ADD CONSTRAINT FK_Emp_Dept FOREIGN KEY (DeptID)
    REFERENCES DEPARTMENT(DeptID);

-- PROJECT
CREATE TABLE PROJECT (
    ProjID INT PRIMARY KEY,
    ProjName NVARCHAR(50) NOT NULL,
    DeptID INT NOT NULL
);

ALTER TABLE PROJECT
ADD CONSTRAINT FK_Proj_Dept FOREIGN KEY (DeptID)
    REFERENCES DEPARTMENT(DeptID);

-- EmployeeProjects (M:N)
CREATE TABLE EmployeeProjects (
    EmpID INT,
    ProjID INT,
    Hours INT DEFAULT 40,
    PRIMARY KEY (EmpID, ProjID),
    FOREIGN KEY (EmpID) REFERENCES EMPLOYEE(EmpID),
    FOREIGN KEY (ProjID) REFERENCES PROJECT(ProjID)
);

-- ============================

INSERT INTO DEPARTMENT VALUES (1,'HR',NULL);
INSERT INTO DEPARTMENT VALUES (2,'IT',NULL);
INSERT INTO DEPARTMENT VALUES (3,'Finance',NULL);

INSERT INTO EMPLOYEE VALUES (101,'Ahmed','M',1,4000);
INSERT INTO EMPLOYEE VALUES (102,'Sara','F',2,4500);
INSERT INTO EMPLOYEE VALUES (103,'Omar','M',2,4200);
INSERT INTO EMPLOYEE VALUES (104,'Laila','F',3,3800);
INSERT INTO EMPLOYEE VALUES (105,'Hany','M',1,3900);

UPDATE DEPARTMENT SET ManagerID = 101 WHERE DeptID = 1;
UPDATE DEPARTMENT SET ManagerID = 102 WHERE DeptID = 2;
UPDATE DEPARTMENT SET ManagerID = 104 WHERE DeptID = 3;

INSERT INTO PROJECT VALUES (201,'Payroll',1);
INSERT INTO PROJECT VALUES (202,'Website',2);
INSERT INTO PROJECT VALUES (203,'Budget',3);

INSERT INTO EmployeeProjects VALUES (101,201,40);
INSERT INTO EmployeeProjects VALUES (102,202,35);
INSERT INTO EmployeeProjects VALUES (103,202,40);
INSERT INTO EmployeeProjects VALUES (104,203,30);
INSERT INTO EmployeeProjects VALUES (105,201,20);

-- ============================


UPDATE EMPLOYEE SET DeptID = 3 WHERE EmpID = 105; 

-- DELETE FROM Dependents WHERE DepID = 301;

-- ============================

SELECT * FROM EMPLOYEE WHERE DeptID = 2;
SELECT e.EmpID, e.Name, p.ProjName, ep.Hours
FROM EMPLOYEE e
LEFT JOIN EmployeeProjects ep ON e.EmpID = ep.EmpID
LEFT JOIN PROJECT p ON ep.ProjID = p.ProjID
ORDER BY e.EmpID;
